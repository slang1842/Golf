
<%= render :partial => 'share/header_menu' %>


<% if current_user.golf_club.accepted == "yes" %>
  <%if current_user.golf_club.active? %>
    <div class="club_wrap">
      <div class="club_info_wrap">
        <h1><%=@club.name%></h1>
        <p><span class="gray"><%=@club.city%>, <%=@club.region%></span></p>
        <p><span class="gray"><%=@club.web_page%></span></p>
        <p><a href="/club/edit">Rediģēt kluba info</a> | <a href="<%=new_golf_club_field_path%>">Pievienot laukumu</a>  | <a href="/club/edit_fields">Rediģēt laukumus</a> </p>
      </div>

      <div class="club_players_wrap">
        <% @users.each do |user|%>

          <div class="single_player_wrap">
            <div class="profile_info">
              <div class="image">
                <img src="<%=user.image.url%>" alt=""/>
              </div>
              <div class="text">
                <p><%=user.first_name%></p>
                <p><%=user.last_name%></p>
                <p><span class="gray">HCP:</span> <%=user.hcp%></p>


                <%= form_for(user, :url => ('/user/update_hints/' + user.id.to_s), :html => {:class => "hints_checkbox"}, :remote => :true) do |u|%>
                   <%= u.hidden_field(:coach, { :class => "user_coach"})%>
                  <p>Dot padomus <input type="checkbox" onchange="change_coach" class="coach_checkbox" checked>
                   <script type="text/javascript">
                   $(document).ready(function() {
                         change_coach();
                            });
                         function change_coach(){
                         if ($('.coach_checkbox:input').checked() == true) { 
                           $('.user_coach').val('<%= escape_javascript(current_user.id.to_s)%>');
                            } 
                           else { $('.user_coach').val(''); }
                         $('.hints_checkbox').submit()
                            }
                    </script>
                  <%end%></p>


              </div>
              <p><%=user.email%></p>
            </div>





            <% @sticks = user.users_sticks%>
            <% @sticks.each do |stick| %>
              <% @stats = AllStickStatistic.find(:first, :conditions => {:stick_id => stick.stick_id, :user_id => user.id})%>
              <div class="single_club_wrap">
                <div class="club_name">
                  <p><%=stick.stick.stick_type%></p>
                </div>


                <div class="progress_bar">
                  <% unless @stats.stick_progres == nil %>
                    <%  if @stats.stick_progres < 35 %>
                      <div class="progress_active bad" style="width:<%= " #{@stats.stick_progres.to_s}%" %>">
                      </div>
                    <%else%>
                      <div class="progress_active normal" style="width: <%= " #{ @stats.stick_progres.to_s}%"%>">
                      </div>
                    <%end%>
                  <%end%>
                </div>


                <div class="info">
                  <p>
                    USAGE:
                    <% unless @stats.usage == nil %>
                      <%="#{@stats.usage}%" %>
                    <% else %>
                      N/A
                    <% end %>
                    <br />
                    AVG:
                    <% unless @stats.avg_distance == nil %>
                      <%="#{@stats.avg_distance}m"%>
                    <%  else %>
                      N/A
                    <% end %>
                  </p>
                </div>
              </div>
            <%end%>
          </div>
          <div class="clear"></div>
          <div class="bottom_line" style="margin-bottom:10px">
            <img src="images/my_club_gradient.png" alt=""/>
          </div>
        <%end%>

      </div>
    </div>
    
    <% @users_w_no_coach.each do |user| %>
    <div class="single_player_wrap">
            <div class="profile_info">
              <div class="image">
                <img src="<%=user.image.url%>" alt=""/>
              </div>
              <div class="text">
                <p><%=user.first_name%></p>
                <p><%=user.last_name%></p>
                <p><span class="gray">HCP:</span> <%=user.hcp%></p>


                <%= form_for(user, :url => ('/user/update_hints/' + user.id.to_s), :html => {:class => "hints_checkbox"}, :remote => :true) do |u|%>
                   <%= u.hidden_field(:coach, {:value => user.coach, :class => "user_coach"})%>
                  <p>Dot padomus <input type="checkbox" onchange="change_coach" class="coach_checkbox" unchecked>
                    <script type="text/javascript">
                        function change_coach(){
                         if ($('.coach_checkbox:input').attr("checked") == true) {
                            $('.user_coach').val('<%= escape_javascript(current_user.id.to_s)%>');
                            }
                             else { $('.user_coach').val(''); }
                         $('.hints_checkbox').submit()
                            }
                    </script>
                  <%end%></p>


              </div>
              <p><%=user.email%></p>
            </div>





            <% @sticks = user.users_sticks%>
            <% @sticks.each do |stick| %>
              <% @stats = AllStickStatistic.find(:first, :conditions => {:stick_id => stick.stick_id, :user_id => user.id})%>
              <div class="single_club_wrap">
                <div class="club_name">
                  <p><%=stick.stick.stick_type%></p>
                </div>


                <div class="progress_bar">
                  <% unless @stats.stick_progres == nil %>
                    <%  if @stats.stick_progres < 35 %>
                      <div class="progress_active bad" style="width:<%= " #{@stats.stick_progres.to_s}%" %>">
                      </div>
                    <%else%>
                      <div class="progress_active normal" style="width: <%= " #{ @stats.stick_progres.to_s}%"%>">
                      </div>
                    <%end%>
                  <%end%>
                </div>


                <div class="info">
                  <p>
                    USAGE:
                    <% unless @stats.usage == nil %>
                      <%="#{@stats.usage}%" %>
                    <% else %>
                      N/A
                    <% end %>
                    <br />
                    AVG:
                    <% unless @stats.avg_distance == nil %>
                      <%="#{@stats.avg_distance}m"%>
                    <%  else %>
                      N/A
                    <% end %>
                  </p>
                </div>
              </div>
            <%end%>
          </div>
          <div class="clear"></div>
          <div class="bottom_line" style="margin-bottom:10px">
            <img src="images/my_club_gradient.png" alt=""/>
          </div>
        <%end%>

      </div>
  <% else %>
    You must complete club registration, for club to be active. You can do that <%= link_to "here", edit_golf_club_path %>
  <% end %>

<% elsif current_user.golf_club.accepted == "no" %>
  your club has not beed accepted
<% else %>
  Administrator has not yet accepted your club
<% end %>
